# Youtube downloader (yt-dlp is the maintained fork of youtube-dl)
alias youtube-mp3='yt-dlp -x --audio-format mp3 --audio-quality 0'

# eve - export vscode extensions
alias eve="code --list-extensions |
xargs -L 1 echo code --install-extension |
sed 's/$/ --force/' |
sed '\$!s/$/ \&/' > ~/dotfiles/setup/vscode/install-extensions.sh"

# Django Stuff
alias djrun='find . -maxdepth 2 -name "manage.py" -exec python3 "{}" runserver \;'
alias djsu='find . -maxdepth 2 -name "manage.py" -exec python3 "{}" createsuperuser --email="admin@localhost.com" \;'
alias djmm='find . -maxdepth 2 -name "manage.py" -exec python3 "{}" makemigrations \;'
alias djmig='find . -maxdepth 2 -name "manage.py" -exec python3 "{}" migrate \;'
alias djsh='find . -maxdepth 2 -name manage.py -exec python3 "{}" shell \;'
alias djshp='find . -maxdepth 2 -name manage.py -exec python3 "{}" shell_plus --print-sql \;'

alias pepfix='autopep8 --max-line-length=120 -i'

# Virtualenv
alias sv='if [[ ! -d "venv" && ! -L "venv" ]]; then virtualenv -p $(command -v python3) venv; touch requirements.txt; fi; source venv/bin/activate; export PS1="(${${PWD##*/}:0:5}â€¦/venv)$_OLD_VIRTUAL_PS1"'
alias sv3=sv
# Note: sv2 removed - Python 2 reached end of life in 2020

# ------------------------------------------------------------------------------
# | Git Commands                                                               |
# ------------------------------------------------------------------------------
# Undo a `git push` (uses default branch)
alias undopush='git push -f origin HEAD^:$(git symbolic-ref refs/remotes/origin/HEAD 2>/dev/null | sed "s@^refs/remotes/origin/@@" || echo "main")'

alias gp='git push origin HEAD'
alias gpf='git push origin HEAD --force-with-lease'
alias gpff='git push origin HEAD --force'
alias gd='git diff'
alias gds='git diff --staged'
alias gl='git log'
# Go back to the last branch
alias gc='git checkout -'
alias gs='git status'
alias gcl='git clone'
alias gcm='git commit -m'
alias gaa='git add :/; git status -sb'
# Updates default branch of upstream project and falls back to your patch branch
# so that you can start rebasing/merging
alias gsync='default_branch=$(git symbolic-ref refs/remotes/origin/HEAD 2>/dev/null | sed "s@^refs/remotes/origin/@@" || echo "main"); git checkout $default_branch; git pull upstream $default_branch; git push origin $default_branch; git checkout -'

# ------------------------------------------------------------------------------
# | Network                                                                    |
# ------------------------------------------------------------------------------

# Enhanced WHOIS lookups
alias whois="whois -h whois-servers.net"

# IP addresses
alias ip="curl ipinfo.io/ip"
alias localip='ipconfig getifaddr en0 2>/dev/null || ipconfig getifaddr en1'

# Copy my public key to my clipboard
alias pubkey="more ~/.ssh/id_rsa.pub | pbcopy | echo '=> Public key copied to pasteboard.'"

# View HTTP traffic
alias sniff="sudo ngrep -d 'en0' -t '^(GET|POST) ' 'tcp and port 80'"
alias httpdump="sudo tcpdump -i en0 -n -s 0 -w - | grep -a -o -E \"Host\: .*|GET \/.*\""

# Gzip-enabled `curl`
alias gurl="curl --compressed"

# Recursively delete `.DS_Store` files
alias cleanup="find . -name '*.DS_Store' -type f -ls -delete"
alias pycclean='find . -name \*.pyc -type f -ls -delete'

# Remove unlinked packages + stale links on MacOS
alias cleanmac="brew cleanup -s"

alias df='df -h'
alias du='du -hs'

alias halt='sudo shutdown -h now'
alias reboot='sudo reboot'

# ----------------------------------------------------------------------------
# | Docker                                                                    |
# ----------------------------------------------------------------------------
alias dcdjmm='docker-compose -f local.yml run django python3 manage.py makemigrations'
alias dcdjmig='docker-compose -f local.yml run django python3 manage.py migrate'
alias dcup='docker-compose -f local.yml up'

# ----------------------------------------------------------------------------
# | Kubernetes - Minimal, battle-tested aliases for CKA/CKAD                 |
# ----------------------------------------------------------------------------

# Core kubectl shortcuts
alias k='kubectl'
alias kg='kubectl get'
alias kd='kubectl describe'
alias ke='kubectl edit'
alias kdel='kubectl delete'
alias kaf='kubectl apply -f'
alias kcf='kubectl create -f'

# Get resources (most frequently used)
alias kgp='kubectl get pods'
alias kgpa='kubectl get pods --all-namespaces'
alias kgd='kubectl get deployments'
alias kgs='kubectl get svc'
alias kgn='kubectl get nodes'
alias kga='kubectl get all'
alias kgaa='kubectl get all --all-namespaces'

# Describe resources
alias kdp='kubectl describe pod'
alias kdd='kubectl describe deployment'
alias kdn='kubectl describe node'

# Logs and exec
alias kl='kubectl logs'
alias klf='kubectl logs -f'
alias kex='kubectl exec -it'

# Namespace management (critical for exams)
alias kns='kubectl config set-context --current --namespace'
alias kgns='kubectl get namespaces'

# Edit resources
alias kep='kubectl edit pod'
alias ked='kubectl edit deployment'

# Dry run for generating YAML (combine with export do below)
alias kdr='kubectl --dry-run=client -o yaml'

# Watch resources
alias kgpw='kubectl get pods -w'

# CRITICAL: Export variables for exam speed
# Usage: k run nginx --image=nginx $do > pod.yaml
export do='--dry-run=client -o yaml'
export kforce='--force --grace-period=0'


# ------------------------------------------------------------------------------
# | PDF Utilities                                                              |
# ------------------------------------------------------------------------------

compresspdf() {
    if [ $# -lt 2 ]; then
        echo "Usage: compresspdf INPUT.pdf OUTPUT.pdf [dpi]"
        echo "Default dpi = 200 (good for scanned docs / visa uploads)"
        return 1
    fi

    local input="$1"
    local output="$2"
    local dpi="${3:-200}"   # third arg optional, default 200

    command gs \
      -sDEVICE=pdfwrite \
      -dNOPAUSE -dQUIET -dBATCH \
      -dCompatibilityLevel=1.6 \
      -dDetectDuplicateImages=true \
      -dDownsampleColorImages=true \
      -dColorImageDownsampleType=/Average \
      -dColorImageResolution="$dpi" \
      -dDownsampleGrayImages=true \
      -dGrayImageDownsampleType=/Average \
      -dGrayImageResolution="$dpi" \
      -dDownsampleMonoImages=true \
      -dMonoImageDownsampleType=/Average \
      -dMonoImageResolution=300 \
      -sOutputFile="$output" \
      "$input"
}

# ------------------------------------------------------------------------------
# | Other                                                                      |
# ------------------------------------------------------------------------------

alias path='echo -e ${PATH//:/\\n}'
alias now='date +"%T"'
alias week='date +%V'
